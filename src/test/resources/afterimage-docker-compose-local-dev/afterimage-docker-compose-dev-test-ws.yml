services:
#  SC Redis 6379
  superconductor-db:
    image: "redis:8.0.0"
    hostname: superconductor-db
    ports:
      - "6379:6379"
    healthcheck:
      test: [ "CMD", "redis-cli" ,"ping", "superconductor-db" ]
      retries: 3
      interval: 1s
      timeout: 2s
    networks:
      - docker_network
#  SC App 5555
  superconductor-afterimage:
    image: avlo/superconductor-app-redis:1.17.1
    ports:
      - "5555:5555"
    healthcheck:
      test: [ "CMD", "wget", "--no-verbose", "--spider", "http://localhost:5555/api-tests.html" ]
      retries: 3
      interval: 1s
      timeout: 3s
      start_period: 3s
    depends_on:
      superconductor-db:
        condition: service_healthy
    networks:
      - docker_network
    environment:
      SPRING_PROFILES_ACTIVE: dev_ws
      SPRING_DATA_REDIS_HOST: superconductor-db
#  SC Redis 6379
  superconductor-db-two:
    image: "redis:8.0.0"
    hostname: superconductor-db-two
    ports:
      - "6378:6379"
    healthcheck:
      test: [ "CMD", "redis-cli" ,"ping", "superconductor-db-two" ]
      retries: 3
      interval: 1s
      timeout: 2s
    networks:
      - docker_network
  #        
  #  SC App 5555
  superconductor-afterimage-two:
    image: avlo/superconductor-app-redis:1.17.1
    ports:
      - "5554:5555"
    healthcheck:
      test: [ "CMD", "wget", "--no-verbose", "--spider", "http://localhost:5555/api-tests.html" ]
      retries: 3
      interval: 1s
      timeout: 3s
      start_period: 3s
    depends_on:
      superconductor-db-two:
        condition: service_healthy
    networks:
      - docker_network
    environment:
      SPRING_PROFILES_ACTIVE: dev_ws
      SPRING_DATA_REDIS_HOST: superconductor-db-two
#
#   aImg App2's Redis 6381 (docker container)
  afterimage-db-two:
    image: "redis:8.0.0"
    hostname: afterimage-db-two
    ports:
      - "6381:6379"
    healthcheck:
      test: [ "CMD", "redis-cli" ,"ping", "afterimage-db-two" ]
      retries: 3
      interval: 1s
      timeout: 2s
    networks:
      - docker_network
#  
# aImg App2 5557 (docker container)
  afterimage-app:
    image: afterimage-nostr-reputation-relay:1.1.0
    ports:
      - "5557:5556"
    healthcheck:
      test: [ "CMD", "wget", "--no-verbose", "--spider", "http://localhost:5556/api-tests.html" ]
      retries: 3
      interval: 1s
      timeout: 3s
      start_period: 3s
    depends_on:
      afterimage-db-two:
        condition: service_healthy
    networks:
      - docker_network
    environment:
      SPRING_PROFILES_ACTIVE: dev_ws
      SPRING_DATA_REDIS_HOST: afterimage-db-two
#
volumes:
  superconductor-db:
    driver: local
  superconductor-db-two:
    driver: local
  afterimage-db-two:
    driver: local
networks:
  docker_network:
    driver: bridge
